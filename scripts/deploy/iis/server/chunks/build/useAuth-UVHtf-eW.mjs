import{ref as e,computed as s,readonly as a}from"vue";import{u as l}from"./useErrorHandler-y_M1hPJN.mjs";import{e as o}from"./server.mjs";const useAuth=()=>{const{handleAsyncError:n}=l(),u=o(),r=e(null),t=e(null),i=e(""),c=e([]),g=s(()=>!!r.value&&!!t.value),v=e(!1),clearAuthData=()=>{r.value=null,t.value=null,i.value="",c.value=[]};return{user:a(r),token:a(t),role:a(i),menuIds:a(c),isAuthenticated:g,isInitialized:a(v),login:async(e,s)=>await n(async()=>{console.log("Login request:",{url:`${u.public.apiBaseUrl}/api/Auth/login`,body:{UsernameOrEmail:e,Password:s}});const a=await $fetch(`${u.public.apiBaseUrl}/api/Auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:{UsernameOrEmail:e,Password:s}});return console.log("Login response:",a),console.log("Response Status:",a.Status),console.log("Response User:",a.User),console.log("Response Token:",a.Token),!("Success"!==a.Status||!a.User||!a.Token)&&(console.log("Login successful, setting user data..."),r.value=a.User,t.value=a.Token,i.value=a.Role,c.value=a.MenuIds,!0)},"Đăng nhập")||!1,logout:()=>{clearAuthData()},getCurrentUser:()=>r.value,getToken:()=>t.value,getRole:()=>i.value,getMenuIds:()=>c.value,getUserDisplayName:()=>{if(!r.value)return"";return`${r.value.firstName||""} ${r.value.lastName||""}`.trim()||r.value.username},initializeAuth:()=>{},clearAuthData:clearAuthData}};export{useAuth as u};
