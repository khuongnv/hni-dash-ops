import{l as ft,d,m as ct,ae as gt,A as U,C as e,N as a,Q as H,D as s,_ as p,al as S,R as pt,B as g,P as o,u as b,af as mt,V as E,ag as q,O as f,E as B,F as vt,ah as yt,aj as bt,ak as _t,Z as wt,$ as P}from"./CXrpKCn2.js";import{_ as xt}from"./vaddv-uB.js";import{_ as K,a as X,b as O,c as Y}from"./HuV0b2Xd.js";import{_ as Z}from"./CenQ87kS.js";import{_ as m}from"./qZElNH4Q.js";import{_ as ht}from"./DuwWExOE.js";import{_ as N}from"./CchPNN15.js";import{_ as Nt,a as kt,b as j,c as k,d as Tt,e as v}from"./DEZtr9RY.js";import{_ as et}from"./BRkL9H2T.js";import{u as Ct}from"./BYp8H9Jv.js";import{u as $t}from"./BvMX9gl2.js";import{u as Vt}from"./wptq1C8v.js";import"./DrkHBoYJ.js";import"#entry";import"./BEHD0UYf.js";const Bt=()=>{const{handleAsyncError:c}=$t(),{get:y,post:D,put:A,delete:F}=Vt();return{getNotifications:async(r=1,u=10,i)=>await c(async()=>{const h={page:r,pageSize:u};return i&&(h.search=i),await y("/api/systemnotifications",h)},"getNotifications"),getNotificationById:async r=>await c(async()=>await y(`/api/systemnotifications/${r}`),"getNotificationById"),createNotification:async r=>await c(async()=>await D("/api/systemnotifications",r),"createNotification"),updateNotification:async(r,u)=>await c(async()=>await A(`/api/systemnotifications/${r}`,u),"updateNotification"),deleteNotification:async r=>await c(async()=>(await F(`/api/systemnotifications/${r}`),!0),"deleteNotification"),markAsRead:async(r,u)=>await c(async()=>(await D(`/api/systemnotifications/${r}/mark-read`,{userId:u}),!0),"markAsRead"),getUnreadNotifications:async r=>await c(async()=>await y(`/api/systemnotifications/unread/${r}`),"getUnreadNotifications"),getNotificationsByType:async(r,u=1,i=10)=>await c(async()=>await y(`/api/systemnotifications/by-type/${r}`,{page:u,pageSize:i}),"getNotificationsByType"),getNotificationsByPriority:async r=>await c(async()=>await y("/api/systemnotifications/high-priority"),"getNotificationsByPriority")}},Dt={class:"h-full flex flex-col space-y-6"},Lt={class:"flex items-center justify-between"},Mt={class:"flex items-center gap-4"},Ut={class:"flex items-center gap-2"},Ht={class:"rounded-md border"},St={class:"flex items-center justify-center gap-2"},Et={class:"space-y-1"},Pt={class:"font-medium"},jt={class:"text-sm text-muted-foreground line-clamp-2"},At={class:"text-sm"},Ft={class:"flex items-center gap-1"},It={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},zt={class:"space-y-2"},Qt={class:"space-y-2"},Rt={class:"grid gap-4 md:grid-cols-2"},qt={class:"space-y-2"},Kt={class:"space-y-2"},Xt={class:"grid gap-4 md:grid-cols-2"},Ot={class:"space-y-2"},Yt={class:"space-y-2"},Zt={class:"flex justify-end gap-2 pt-4"},Gt={key:1,class:"fixed inset-0 z-50 flex items-center justify-center"},Jt={class:"space-y-2"},Wt={class:"flex justify-end gap-2 pt-4"},me=ft({__name:"system-notifications",setup(c){Ct({title:"Quản lý Thông báo Hệ thống - HNI Dashboard"});const{getNotifications:y,createNotification:D,updateNotification:A,deleteNotification:F}=Bt(),I=d([]),_=d(!1),T=d(!1),C=d(!1),$=d(""),w=d("all"),x=d("all"),V=d(!1),L=d(!1),r=d(!1),u=d(null),i=d({id:null,title:"",message:"",type:"info",status:"active",start_at:null,end_at:null}),h=ct(()=>{let n=I.value;if($.value){const t=$.value.toLowerCase();n=n.filter(l=>l.title.toLowerCase().includes(t)||l.message.toLowerCase().includes(t))}return w.value&&w.value!=="all"&&(n=n.filter(t=>t.type===w.value)),x.value&&x.value!=="all"&&(n=n.filter(t=>t.status===x.value)),n}),G=n=>({info:"Thông tin",warning:"Cảnh báo",error:"Lỗi",success:"Thành công"})[n]||n,st=n=>({info:"secondary",warning:"secondary",error:"destructive",success:"default"})[n]||"secondary",at=n=>({info:"bg-blue-100 text-blue-800",warning:"bg-yellow-100 text-yellow-800",error:"bg-red-100 text-red-800",success:"bg-green-100 text-green-800"})[n]||"",nt=n=>new Date(n).toLocaleString("vi-VN"),J=n=>{if(!n)return null;const t=new Date(n+"T00:00:00"),l=t.getFullYear(),R=String(t.getMonth()+1).padStart(2,"0"),dt=String(t.getDate()).padStart(2,"0");return`${l}-${R}-${dt}`},M=async()=>{try{_.value=!0;const n=await y();I.value=n||[]}catch(n){console.error("Error loading notifications:",n)}finally{_.value=!1}},W=()=>{},tt=()=>{i.value={id:null,title:"",message:"",type:"info",status:"active",start_at:null,end_at:null}},lt=()=>{r.value=!1,tt(),V.value=!0},ot=n=>{r.value=!0,V.value=!0,i.value={id:n.id,title:n.title,message:n.message,type:n.type,status:n.status,start_at:J(n.start_at),end_at:J(n.end_at)}},z=()=>{V.value=!1,tt()},it=async()=>{try{if(T.value=!0,!i.value.title||!i.value.title.trim()){alert("Vui lòng nhập tiêu đề thông báo");return}if(!i.value.message||!i.value.message.trim()){alert("Vui lòng nhập nội dung thông báo");return}const n={title:i.value.title.trim(),message:i.value.message.trim(),type:i.value.type,status:i.value.status,start_at:i.value.start_at,end_at:i.value.end_at};r.value?await A(i.value.id,n):await D(n),await M(),z()}catch(n){console.error("Error saving notification:",n)}finally{T.value=!1}},rt=n=>{u.value=n,L.value=!0},Q=()=>{L.value=!1,u.value=null},ut=async()=>{if(u.value)try{C.value=!0,await F(u.value.id),await M(),Q()}catch(n){console.error("Error deleting notification:",n)}finally{C.value=!1}};return gt(()=>{M()}),(n,t)=>(g(),U("div",Dt,[e(xt,{title:"Quản lý Thông báo Hệ thống",description:"Quản lý các thông báo và cảnh báo của hệ thống"}),a("div",Lt,[a("div",Mt,[e(m,{onClick:lt,class:"flex items-center gap-2"},{default:s(()=>[e(b(mt),{class:"w-4 h-4"}),t[9]||(t[9]=o(" Thêm thông báo mới ",-1))]),_:1}),e(m,{variant:"outline",onClick:M,disabled:_.value},{default:s(()=>[e(b(E),{class:q(["w-4 h-4",{"animate-spin":_.value}])},null,8,["class"]),t[10]||(t[10]=o(" Làm mới ",-1))]),_:1},8,["disabled"])]),a("div",Ut,[p(a("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>w.value=l),onChange:W,class:"w-40 h-10 px-3 py-2 text-sm border border-input bg-background rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[...t[11]||(t[11]=[pt('<option value="all">Tất cả</option><option value="info">Thông tin</option><option value="warning">Cảnh báo</option><option value="error">Lỗi</option><option value="success">Thành công</option>',5)])],544),[[S,w.value]]),p(a("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>x.value=l),onChange:W,class:"w-40 h-10 px-3 py-2 text-sm border border-input bg-background rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[...t[12]||(t[12]=[a("option",{value:"all"},"Tất cả",-1),a("option",{value:"active"},"Hoạt động",-1),a("option",{value:"inactive"},"Tạm dừng",-1)])],544),[[S,x.value]]),e(ht,{modelValue:$.value,"onUpdate:modelValue":t[2]||(t[2]=l=>$.value=l),placeholder:"Tìm kiếm thông báo...",class:"w-64"},null,8,["modelValue"])])]),e(K,null,{default:s(()=>[e(X,null,{default:s(()=>[e(O,null,{default:s(()=>[...t[13]||(t[13]=[o("Danh sách Thông báo",-1)])]),_:1}),e(Z,null,{default:s(()=>[o(" Tổng cộng "+f(h.value.length)+" thông báo ",1)]),_:1})]),_:1}),e(Y,null,{default:s(()=>[a("div",Ht,[e(Nt,null,{default:s(()=>[e(kt,null,{default:s(()=>[e(j,null,{default:s(()=>[e(k,{class:"w-12"},{default:s(()=>[...t[14]||(t[14]=[o("#",-1)])]),_:1}),e(k,null,{default:s(()=>[...t[15]||(t[15]=[o("Tiêu đề",-1)])]),_:1}),e(k,null,{default:s(()=>[...t[16]||(t[16]=[o("Loại",-1)])]),_:1}),e(k,null,{default:s(()=>[...t[17]||(t[17]=[o("Trạng thái",-1)])]),_:1}),e(k,null,{default:s(()=>[...t[18]||(t[18]=[o("Ngày tạo",-1)])]),_:1}),e(k,{class:"w-32"},{default:s(()=>[...t[19]||(t[19]=[o("Thao tác",-1)])]),_:1})]),_:1})]),_:1}),e(Tt,null,{default:s(()=>[_.value?(g(),B(j,{key:0},{default:s(()=>[e(v,{colspan:"6",class:"text-center py-8"},{default:s(()=>[a("div",St,[e(b(E),{class:"w-4 h-4 animate-spin"}),t[20]||(t[20]=o(" Đang tải... ",-1))])]),_:1})]),_:1})):h.value.length===0?(g(),B(j,{key:1},{default:s(()=>[e(v,{colspan:"6",class:"text-center py-8 text-muted-foreground"},{default:s(()=>[...t[21]||(t[21]=[o(" Không có thông báo nào ",-1)])]),_:1})]),_:1})):(g(!0),U(vt,{key:2},yt(h.value,l=>(g(),B(j,{key:l.id,class:q({"bg-blue-50/50":l.type==="info","bg-yellow-50/50":l.type==="warning","bg-red-50/50":l.type==="error","bg-green-50/50":l.type==="success"})},{default:s(()=>[e(v,{class:"font-medium"},{default:s(()=>[o(f(l.id),1)]),_:2},1024),e(v,null,{default:s(()=>[a("div",Et,[a("div",Pt,f(l.title),1),a("div",jt,f(l.message),1)])]),_:2},1024),e(v,null,{default:s(()=>[e(et,{variant:st(l.type),class:q(at(l.type))},{default:s(()=>[o(f(G(l.type)),1)]),_:2},1032,["variant","class"])]),_:2},1024),e(v,null,{default:s(()=>[e(et,{variant:l.status==="active"?"default":"destructive"},{default:s(()=>[o(f(l.status==="active"?"Hoạt động":"Tạm dừng"),1)]),_:2},1032,["variant"])]),_:2},1024),e(v,null,{default:s(()=>[a("div",At,f(nt(l.created_at)),1)]),_:2},1024),e(v,null,{default:s(()=>[a("div",Ft,[e(m,{variant:"ghost",size:"sm",onClick:R=>ot(l)},{default:s(()=>[e(b(bt),{class:"w-4 h-4"})]),_:1},8,["onClick"]),e(m,{variant:"ghost",size:"sm",onClick:R=>rt(l),class:"text-destructive hover:text-destructive"},{default:s(()=>[e(b(_t),{class:"w-4 h-4"})]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})])]),_:1})]),_:1}),V.value?(g(),U("div",It,[a("div",{class:"fixed inset-0 bg-black/50",onClick:z}),e(K,{class:"relative w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"},{default:s(()=>[e(X,null,{default:s(()=>[e(O,null,{default:s(()=>[o(f(r.value?"Chỉnh sửa Thông báo":"Thêm Thông báo Mới"),1)]),_:1}),e(Z,null,{default:s(()=>[o(f(r.value?"Cập nhật thông tin thông báo":"Tạo thông báo mới cho hệ thống"),1)]),_:1})]),_:1}),e(Y,null,{default:s(()=>[a("form",{onSubmit:wt(it,["prevent"]),class:"space-y-4"},[a("div",zt,[e(N,{for:"title"},{default:s(()=>[...t[22]||(t[22]=[o("Tiêu đề *",-1)])]),_:1}),p(a("input",{id:"title","onUpdate:modelValue":t[3]||(t[3]=l=>i.value.title=l),placeholder:"Nhập tiêu đề thông báo",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",required:""},null,512),[[P,i.value.title]])]),a("div",Qt,[e(N,{for:"message"},{default:s(()=>[...t[23]||(t[23]=[o("Nội dung *",-1)])]),_:1}),p(a("textarea",{id:"message","onUpdate:modelValue":t[4]||(t[4]=l=>i.value.message=l),placeholder:"Nhập nội dung thông báo",class:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",required:""},null,512),[[P,i.value.message]])]),a("div",Rt,[a("div",qt,[e(N,{for:"type"},{default:s(()=>[...t[24]||(t[24]=[o("Loại thông báo",-1)])]),_:1}),p(a("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>i.value.type=l),class:"w-full h-10 px-3 py-2 text-sm border border-input bg-background rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[...t[25]||(t[25]=[a("option",{value:"info"},"Thông tin",-1),a("option",{value:"warning"},"Cảnh báo",-1),a("option",{value:"error"},"Lỗi",-1),a("option",{value:"success"},"Thành công",-1)])],512),[[S,i.value.type]])]),a("div",Kt,[e(N,{for:"status"},{default:s(()=>[...t[26]||(t[26]=[o("Trạng thái",-1)])]),_:1}),p(a("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>i.value.status=l),class:"w-full h-10 px-3 py-2 text-sm border border-input bg-background rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[...t[27]||(t[27]=[a("option",{value:"active"},"Hoạt động",-1),a("option",{value:"inactive"},"Tạm dừng",-1)])],512),[[S,i.value.status]])])]),a("div",Xt,[a("div",Ot,[e(N,{for:"start_at"},{default:s(()=>[...t[28]||(t[28]=[o("Bắt đầu (tùy chọn)",-1)])]),_:1}),p(a("input",{id:"start_at","onUpdate:modelValue":t[7]||(t[7]=l=>i.value.start_at=l),type:"date",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},null,512),[[P,i.value.start_at]])]),a("div",Yt,[e(N,{for:"end_at"},{default:s(()=>[...t[29]||(t[29]=[o("Kết thúc (tùy chọn)",-1)])]),_:1}),p(a("input",{id:"end_at","onUpdate:modelValue":t[8]||(t[8]=l=>i.value.end_at=l),type:"date",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},null,512),[[P,i.value.end_at]])])]),a("div",Zt,[e(m,{type:"button",variant:"outline",onClick:z},{default:s(()=>[...t[30]||(t[30]=[o(" Hủy ",-1)])]),_:1}),e(m,{type:"submit",disabled:T.value},{default:s(()=>[T.value?(g(),B(b(E),{key:0,class:"w-4 h-4 animate-spin mr-2"})):H("",!0),o(" "+f(r.value?"Cập nhật":"Tạo mới"),1)]),_:1},8,["disabled"])])],32)]),_:1})]),_:1})])):H("",!0),L.value?(g(),U("div",Gt,[a("div",{class:"fixed inset-0 bg-black/50",onClick:Q}),e(K,{class:"relative w-full max-w-md mx-4"},{default:s(()=>[e(X,null,{default:s(()=>[e(O,{class:"text-destructive"},{default:s(()=>[...t[31]||(t[31]=[o("Xác nhận xóa",-1)])]),_:1}),e(Z,null,{default:s(()=>[...t[32]||(t[32]=[o(" Bạn có chắc chắn muốn xóa thông báo này không? ",-1)])]),_:1})]),_:1}),e(Y,null,{default:s(()=>[a("div",Jt,[a("p",null,[t[33]||(t[33]=a("strong",null,"Tiêu đề:",-1)),o(" "+f(u.value?.title),1)]),a("p",null,[t[34]||(t[34]=a("strong",null,"Loại:",-1)),o(" "+f(G(u.value?.type)),1)]),t[35]||(t[35]=a("p",{class:"text-sm text-muted-foreground"}," Hành động này không thể hoàn tác. ",-1))]),a("div",Wt,[e(m,{variant:"outline",onClick:Q},{default:s(()=>[...t[36]||(t[36]=[o(" Hủy ",-1)])]),_:1}),e(m,{variant:"destructive",onClick:ut,disabled:C.value},{default:s(()=>[C.value?(g(),B(b(E),{key:0,class:"w-4 h-4 animate-spin mr-2"})):H("",!0),t[37]||(t[37]=o(" Xóa ",-1))]),_:1},8,["disabled"])])]),_:1})]),_:1})])):H("",!0)]))}});export{me as default};
