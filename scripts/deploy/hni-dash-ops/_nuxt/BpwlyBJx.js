import{l as Ce,d as c,m as Y,ae as we,A as u,C as l,N as s,Q as I,D as a,_ as y,al as ee,O as m,Z as K,$ as L,F as R,ah as X,P as o,B as d,u as k,af as ye,V as te,ag as le,E as O,ai as ke,aj as De,ak as $e}from"./CXrpKCn2.js";import{u as Te}from"./D9iSA-Is.js";import{_ as b}from"./qZElNH4Q.js";import{_ as Ne,a as Me,b as Ve,c as Ee}from"./HuV0b2Xd.js";import{_ as Se}from"./CenQ87kS.js";import{_ as Pe,a as je,b as z,c as x,d as Fe,e as p}from"./DEZtr9RY.js";import{_ as ne}from"./BRkL9H2T.js";import{_ as T}from"./CchPNN15.js";import{_ as Le}from"./vaddv-uB.js";import"./BvMX9gl2.js";import"./wptq1C8v.js";import"#entry";import"./BEHD0UYf.js";import"./DrkHBoYJ.js";const ze={class:"h-full flex flex-col space-y-4"},Be={class:"flex items-center justify-between"},Ue={class:"flex items-center gap-3"},Ae={class:"flex items-center gap-2"},Qe=["value"],qe={key:0,class:"text-blue-600"},He={class:"rounded-md border"},Ge={class:"flex items-center justify-center gap-2"},Ie={class:"flex items-center gap-2"},Ke={class:"flex items-center"},Re={key:0,class:"w-3 h-3 flex items-center justify-center"},Xe={key:1,class:"w-3 h-3 flex items-center justify-center"},Oe=["onClick","title"],Ze={key:1,class:"w-4 h-4"},Je={class:"font-medium text-foreground"},We={key:0,class:"text-sm text-muted-foreground"},Ye={key:1,class:"text-sm text-muted-foreground"},et={key:0,class:"text-sm"},tt={key:1,class:"text-sm text-muted-foreground"},lt={key:0,class:"text-sm text-muted-foreground max-w-xs truncate"},nt={key:1,class:"text-sm text-muted-foreground"},at={class:"flex items-center gap-1"},st={class:"text-lg font-semibold mb-4"},ot=["value"],it={class:"flex gap-3 pt-4"},rt={class:"text-gray-600 mb-6"},dt={class:"flex gap-3"},Dt=Ce({__name:"categories",setup(ut){const{getCategories:ae,createCategory:se,updateCategory:oe,deleteCategory:ie,getParentCategories:Z}=Te(),_=c([]),D=c(!1),h=c(""),N=c("all"),M=c(new Set),V=c(!1),B=c(!1),C=c(!1),E=c(!1),S=c(!1),$=c(null),i=c({id:null,code:"",name:"",parent_id:null,map_id:null,note:""}),J=n=>_.value.some(e=>e.parent_id===n),re=n=>{M.value.has(n)?M.value.delete(n):M.value.add(n)},P=n=>M.value.has(n),U=n=>{if(!n.parent_id)return!1;const e=_.value.find(t=>t.id===n.parent_id);return e?P(e.id)?!0:U(e):!1},de=n=>{const e=[],t=new Set,f=n.filter(r=>!r.parent_id).sort((r,w)=>r.id-w.id),v=r=>{t.has(r.id)||U(r)||(e.push(r),t.add(r.id),P(r.id)||n.filter(g=>g.parent_id===r.id).sort((g,F)=>g.id-F.id).forEach(g=>v(g)))};return f.forEach(r=>v(r)),n.forEach(r=>{!t.has(r.id)&&!U(r)&&e.push(r)}),e},A=n=>n.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/đ/g,"d").replace(/Đ/g,"D"),ue=n=>{const e=[];let t=n.parent_id;for(;t;){const f=_.value.find(v=>v.id===t);if(f)e.unshift(f),t=f.parent_id;else break}return e},Q=Y(()=>{let n=_.value;if(h.value&&h.value.trim()){const e=h.value.toLowerCase().trim(),t=A(e),f=n.filter(r=>{const w=r.name.toLowerCase(),g=A(w),F=r.code.toLowerCase(),he=A(F);return w.includes(e)||g.includes(t)||F.includes(e)||he.includes(t)}),v=new Set;f.forEach(r=>{v.add(r.id),ue(r).forEach(g=>v.add(g.id))}),n=n.filter(r=>v.has(r.id))}return N.value==="root"?n=n.filter(e=>!e.parent_id):N.value==="child"&&(n=n.filter(e=>e.parent_id)),de(n)}),fe=Y(()=>C.value?Z(_.value,i.value.id):Z(_.value)),j=async()=>{D.value=!0;try{_.value=await ae()}catch(n){console.error("Error loading categories:",n)}finally{D.value=!1}},me=()=>{},ce=n=>{const e=_.value.find(t=>t.id===n);return e?`${e.name} (${e.code})`:"Không xác định"},q=n=>{let e=1,t=n.parent_id;for(;t;){e++;const f=_.value.find(v=>v.id===t);if(f)t=f.parent_id;else break}return e},pe=n=>new Date(n).toLocaleDateString("vi-VN"),W=()=>{i.value={id:null,code:"",name:"",parent_id:null,map_id:null,note:""}},ve=()=>{C.value=!1,W(),V.value=!0},_e=n=>{C.value=!0,i.value={id:n.id,code:n.code,name:n.name,parent_id:n.parent_id,map_id:n.map_id,note:n.note||""},V.value=!0},H=()=>{V.value=!1,W()},ge=async()=>{if(!i.value.code.trim()||!i.value.name.trim()){alert("Vui lòng nhập đầy đủ thông tin bắt buộc");return}E.value=!0;try{C.value?await oe(i.value.id,{code:i.value.code,name:i.value.name,parent_id:i.value.parent_id,map_id:i.value.map_id,note:i.value.note||null}):await se({code:i.value.code,name:i.value.name,parent_id:i.value.parent_id,map_id:i.value.map_id,note:i.value.note||null}),await j(),H()}catch(n){console.error("Error submitting form:",n)}finally{E.value=!1}},xe=n=>{$.value=n,B.value=!0},G=()=>{B.value=!1,$.value=null},be=async()=>{if($.value){S.value=!0;try{await ie($.value.id),await j(),G()}catch(n){console.error("Error deleting category:",n)}finally{S.value=!1}}};return we(()=>{j()}),(n,e)=>(d(),u("div",ze,[l(Le,{title:"Quản lý Danh mục",description:"Quản lý các danh mục sản phẩm và dịch vụ"}),s("div",Be,[s("div",Ue,[l(b,{onClick:ve,class:"flex items-center gap-2"},{default:a(()=>[l(k(ye),{class:"w-4 h-4"}),e[9]||(e[9]=o(" Thêm danh mục mới ",-1))]),_:1}),l(b,{variant:"outline",onClick:j,disabled:D.value},{default:a(()=>[l(k(te),{class:le(["w-4 h-4",{"animate-spin":D.value}])},null,8,["class"]),e[10]||(e[10]=o(" Làm mới ",-1))]),_:1},8,["disabled"])]),s("div",Ae,[y(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>N.value=t),onChange:me,class:"w-40 h-10 px-3 py-2 text-sm border border-input bg-background rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},[...e[11]||(e[11]=[s("option",{value:"all"},"Tất cả",-1),s("option",{value:"root"},"Danh mục gốc",-1),s("option",{value:"child"},"Danh mục con",-1)])],544),[[ee,N.value]]),s("input",{value:h.value,onInput:e[1]||(e[1]=t=>h.value=t.target.value),placeholder:"Tìm kiếm danh mục...",class:"w-64 h-10 px-3 py-2 text-sm border border-input bg-background rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"},null,40,Qe)])]),l(Ne,{class:"-mt-2"},{default:a(()=>[l(Me,null,{default:a(()=>[l(Ve,null,{default:a(()=>[...e[12]||(e[12]=[o("Danh sách Danh mục",-1)])]),_:1}),l(Se,null,{default:a(()=>[o(" Tổng cộng "+m(Q.value.length)+" danh mục ",1),h.value?(d(),u("span",qe,' (Tìm kiếm: "'+m(h.value)+'") ',1)):I("",!0)]),_:1})]),_:1}),l(Ee,null,{default:a(()=>[s("div",He,[l(Pe,null,{default:a(()=>[l(je,null,{default:a(()=>[l(z,null,{default:a(()=>[l(x,{class:"w-12"},{default:a(()=>[...e[13]||(e[13]=[o("#",-1)])]),_:1}),l(x,null,{default:a(()=>[...e[14]||(e[14]=[o("Code",-1)])]),_:1}),l(x,null,{default:a(()=>[...e[15]||(e[15]=[o("Tên danh mục",-1)])]),_:1}),l(x,null,{default:a(()=>[...e[16]||(e[16]=[o("Danh mục cha",-1)])]),_:1}),l(x,null,{default:a(()=>[...e[17]||(e[17]=[o("Cấp",-1)])]),_:1}),l(x,null,{default:a(()=>[...e[18]||(e[18]=[o("Map ID",-1)])]),_:1}),l(x,null,{default:a(()=>[...e[19]||(e[19]=[o("Ghi chú",-1)])]),_:1}),l(x,null,{default:a(()=>[...e[20]||(e[20]=[o("Ngày tạo",-1)])]),_:1}),l(x,{class:"w-32"},{default:a(()=>[...e[21]||(e[21]=[o("Thao tác",-1)])]),_:1})]),_:1})]),_:1}),l(Fe,null,{default:a(()=>[D.value?(d(),O(z,{key:0},{default:a(()=>[l(p,{colspan:"9",class:"text-center py-8"},{default:a(()=>[s("div",Ge,[l(k(te),{class:"w-4 h-4 animate-spin"}),e[22]||(e[22]=o(" Đang tải... ",-1))])]),_:1})]),_:1})):Q.value.length===0?(d(),O(z,{key:1},{default:a(()=>[l(p,{colspan:"9",class:"text-center py-8 text-muted-foreground"},{default:a(()=>[...e[23]||(e[23]=[o(" Không có danh mục nào ",-1)])]),_:1})]),_:1})):(d(!0),u(R,{key:2},X(Q.value,t=>(d(),O(z,{key:t.id,class:"table-row-fixed"},{default:a(()=>[l(p,{class:"font-medium align-middle"},{default:a(()=>[o(m(t.id),1)]),_:2},1024),l(p,{class:"align-middle"},{default:a(()=>[l(ne,{variant:"outline"},{default:a(()=>[o(m(t.code),1)]),_:2},1024)]),_:2},1024),l(p,{class:"align-middle"},{default:a(()=>[s("div",Ie,[s("div",Ke,[(d(!0),u(R,null,X(q(t)-1,f=>(d(),u("div",{key:f,class:"w-4 h-4 flex items-center justify-center"},[f===q(t)-1?(d(),u("div",Re,[...e[24]||(e[24]=[s("div",{class:"w-4 h-4 border-l-2 border-b-2 border-muted-foreground/60 rounded-bl-sm"},null,-1)])])):(d(),u("div",Xe,[...e[25]||(e[25]=[s("div",{class:"w-px h-3 bg-border"},null,-1)])]))]))),128))]),J(t.id)?(d(),u("button",{key:0,onClick:f=>re(t.id),class:"flex items-center justify-center w-4 h-4 rounded hover:bg-muted transition-colors cursor-pointer",title:P(t.id)?"Mở rộng":"Thu gọn"},[l(k(ke),{class:le(["w-3 h-3 transition-transform duration-200 text-muted-foreground",P(t.id)?"rotate-0":"rotate-90"])},null,8,["class"])],8,Oe)):(d(),u("div",Ze)),s("div",Je,m(t.name),1)])]),_:2},1024),l(p,{class:"align-middle"},{default:a(()=>[t.parent_id?(d(),u("span",We,m(ce(t.parent_id)),1)):(d(),u("span",Ye,"Danh mục gốc"))]),_:2},1024),l(p,{class:"align-middle"},{default:a(()=>[l(ne,{variant:"outline",class:"text-xs"},{default:a(()=>[o(" Cấp "+m(q(t)),1)]),_:2},1024)]),_:2},1024),l(p,{class:"align-middle"},{default:a(()=>[t.map_id?(d(),u("span",et,m(t.map_id),1)):(d(),u("span",tt,"-"))]),_:2},1024),l(p,{class:"align-middle"},{default:a(()=>[t.note?(d(),u("span",lt,m(t.note),1)):(d(),u("span",nt,"-"))]),_:2},1024),l(p,{class:"text-sm text-muted-foreground"},{default:a(()=>[o(m(pe(t.created_at)),1)]),_:2},1024),l(p,null,{default:a(()=>[s("div",at,[l(b,{variant:"ghost",size:"sm",onClick:f=>_e(t)},{default:a(()=>[l(k(De),{class:"h-4 w-4"})]),_:1},8,["onClick"]),l(b,{variant:"ghost",size:"sm",onClick:f=>xe(t),disabled:J(t.id),class:"text-destructive hover:text-destructive"},{default:a(()=>[l(k($e),{class:"h-4 w-4"})]),_:1},8,["onClick","disabled"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])]),_:1})]),_:1}),V.value?(d(),u("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:H},[s("div",{class:"bg-white rounded-lg p-6 w-full max-w-md mx-4",onClick:e[7]||(e[7]=K(()=>{},["stop"]))},[s("h3",st,m(C.value?"Sửa danh mục":"Thêm danh mục mới"),1),s("form",{onSubmit:K(ge,["prevent"]),class:"space-y-4"},[s("div",null,[l(T,{for:"code"},{default:a(()=>[...e[26]||(e[26]=[o("Code *",-1)])]),_:1}),y(s("input",{id:"code","onUpdate:modelValue":e[2]||(e[2]=t=>i.value.code=t),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nhập code danh mục"},null,512),[[L,i.value.code]])]),s("div",null,[l(T,{for:"name"},{default:a(()=>[...e[27]||(e[27]=[o("Tên danh mục *",-1)])]),_:1}),y(s("input",{id:"name","onUpdate:modelValue":e[3]||(e[3]=t=>i.value.name=t),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nhập tên danh mục"},null,512),[[L,i.value.name]])]),s("div",null,[l(T,{for:"parent_id"},{default:a(()=>[...e[28]||(e[28]=[o("Danh mục cha",-1)])]),_:1}),y(s("select",{id:"parent_id","onUpdate:modelValue":e[4]||(e[4]=t=>i.value.parent_id=t),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[e[29]||(e[29]=s("option",{value:""},"Chọn danh mục cha (tùy chọn)",-1)),(d(!0),u(R,null,X(fe.value,t=>(d(),u("option",{key:t.id,value:t.id},m(t.name)+" ("+m(t.code)+") ",9,ot))),128))],512),[[ee,i.value.parent_id]])]),s("div",null,[l(T,{for:"map_id"},{default:a(()=>[...e[30]||(e[30]=[o("Map ID",-1)])]),_:1}),y(s("input",{id:"map_id","onUpdate:modelValue":e[5]||(e[5]=t=>i.value.map_id=t),type:"number",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nhập Map ID (tùy chọn)"},null,512),[[L,i.value.map_id,void 0,{number:!0}]])]),s("div",null,[l(T,{for:"note"},{default:a(()=>[...e[31]||(e[31]=[o("Ghi chú",-1)])]),_:1}),y(s("textarea",{id:"note","onUpdate:modelValue":e[6]||(e[6]=t=>i.value.note=t),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Nhập ghi chú (tùy chọn)"},null,512),[[L,i.value.note]])]),s("div",it,[l(b,{type:"button",variant:"outline",onClick:H,class:"flex-1"},{default:a(()=>[...e[32]||(e[32]=[o(" Hủy ",-1)])]),_:1}),l(b,{type:"submit",disabled:E.value,class:"flex-1"},{default:a(()=>[o(m(E.value?"Đang xử lý...":C.value?"Cập nhật":"Tạo mới"),1)]),_:1},8,["disabled"])])],32)])])):I("",!0),B.value?(d(),u("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:G},[s("div",{class:"bg-white rounded-lg p-6 w-full max-w-md mx-4",onClick:e[8]||(e[8]=K(()=>{},["stop"]))},[e[38]||(e[38]=s("h3",{class:"text-lg font-semibold mb-4 text-red-600"},"Xác nhận xóa",-1)),s("p",rt,[e[33]||(e[33]=o(" Bạn có chắc chắn muốn xóa danh mục ",-1)),s("strong",null,'"'+m($.value?.name)+'"',1),e[34]||(e[34]=o("? ",-1)),e[35]||(e[35]=s("br",null,null,-1)),e[36]||(e[36]=s("span",{class:"text-sm text-red-500"},"Hành động này không thể hoàn tác.",-1))]),s("div",dt,[l(b,{variant:"outline",onClick:G,class:"flex-1"},{default:a(()=>[...e[37]||(e[37]=[o(" Hủy ",-1)])]),_:1}),l(b,{variant:"destructive",onClick:be,disabled:S.value,class:"flex-1"},{default:a(()=>[o(m(S.value?"Đang xóa...":"Xóa"),1)]),_:1},8,["disabled"])])])])):I("",!0)]))}});export{Dt as default};
