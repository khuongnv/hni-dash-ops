import{l as de,d as f,m as fe,q as W,ae as me,A as r,C as n,N as l,Q as Y,_ as v,$ as T,al as P,D as a,O as d,Z as ee,F as h,ah as M,B as u,P as i,u as O,af as pe,E as D,aj as ge,ak as ve}from"./CXrpKCn2.js";import{_ as b}from"./qZElNH4Q.js";import{_ as ce,a as ye,b as _e,c as be}from"./HuV0b2Xd.js";import{_ as xe,a as we,b as te,c as x,d as ke,e as w}from"./DEZtr9RY.js";import{_ as q}from"./BRkL9H2T.js";import{_}from"./CchPNN15.js";import{_ as Ce}from"./vaddv-uB.js";import{u as he}from"./BvMX9gl2.js";import{u as Ue}from"./wptq1C8v.js";import{u as $e}from"./BcSDHcqX.js";import{u as Ve}from"./D9iSA-Is.js";import"./BEHD0UYf.js";import"./DrkHBoYJ.js";import"#entry";const Te=()=>{const{handleAsyncError:U}=he(),{get:E,post:j,put:F,delete:I}=Ue();return{getUsers:async(g=1,$=10,V="",k="")=>await U(async()=>{const p={page:g,limit:$};return V&&(p.search=V),k&&(p.status=k),await E("/api/users",p)},"Lấy danh sách người dùng"),getUserById:async g=>await U(async()=>await E(`/api/users/${g}`),"Lấy thông tin người dùng"),createUser:async g=>await U(async()=>await j("/api/users",g),"Tạo người dùng"),updateUser:async(g,$)=>await U(async()=>await F(`/api/users/${g}`,$),"Cập nhật người dùng"),deleteUser:async g=>await U(async()=>{await I(`/api/users/${g}`)},"Xóa người dùng")}},Pe={class:"space-y-4"},Me={class:"flex flex-col sm:flex-row gap-3"},Ne={class:"flex-1"},De={class:"flex gap-3"},Ee={class:"flex justify-between items-start"},Se={class:"text-sm text-gray-600"},ze={key:0,class:"text-center py-8"},Be={key:1,class:"text-center py-8"},He={key:2},qe={class:"font-medium text-foreground"},je={key:1,class:"text-gray-500"},Fe={key:1,class:"text-gray-500"},Ie={key:1,class:"text-gray-500"},Ke={class:"flex justify-end gap-2"},Qe={key:0,class:"flex items-center justify-between mt-6"},Ae={class:"flex items-center gap-2"},Le=["value"],Xe={class:"flex items-center gap-2"},Ge={class:"flex items-center gap-1"},Oe={key:1,class:"px-2 text-gray-500"},Re={class:"text-lg font-semibold mb-4"},Ze={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Je=["required"],We=["value"],Ye=["value"],et=["value"],tt=["value"],lt={class:"flex justify-end gap-3 pt-4"},_t=de({__name:"users",setup(U){const{getUsers:E,createUser:j,updateUser:F,deleteUser:I}=Te(),{getDepartments:R}=$e(),{getCategories:Z}=Ve(),S=f([]),K=f([]),Q=f([]),g=f([]),$=f([]),V=f(!1),k=f(!1),p=f(!1),z=f(!1),B=f(""),H=f("all"),c=f(1),A=f(10),y=f({page:1,limit:10,total:0,totalPages:0}),o=f({id:null,full_name:"",username:"",password:"",email:"",department_id:null,role_id:null,position_id:null,gender_id:null,dob:"",status:"active"}),le=fe(()=>{const s=(y.value.page-1)*y.value.limit+1,e=Math.min(y.value.page*y.value.limit,y.value.total);return{start:s,end:e,total:y.value.total}}),C=async()=>{V.value=!0;try{const[s,e,t]=await Promise.all([E(c.value,A.value,B.value.trim(),H.value),R(),Z()]);S.value=s.data,y.value=s.pagination,K.value=e,Q.value=t.filter(m=>m.parent_id===11),g.value=t.filter(m=>m.parent_id===16),$.value=t.filter(m=>m.parent_id===17)}catch(s){console.error("Error loading data:",s)}finally{V.value=!1}},L=async s=>{c.value=s,await C()},ae=async s=>{A.value=s,c.value=1,await C()};let X=null;W(B,()=>{X&&clearTimeout(X),X=setTimeout(async()=>{c.value=1,await C()},500)}),W(H,async()=>{c.value=1,await C()});const ne=()=>{const s=y.value.totalPages,e=c.value,t=[];if(s<=7)for(let m=1;m<=s;m++)t.push(m);else{t.push(1),e>4&&t.push("...");const m=Math.max(2,e-1),re=Math.min(s-1,e+1);for(let N=m;N<=re;N++)N!==1&&N!==s&&t.push(N);e<s-3&&t.push("..."),s>1&&t.push(s)}return t},J=()=>{o.value={id:null,full_name:"",username:"",password:"",email:"",department_id:null,role_id:null,position_id:null,gender_id:null,dob:"",status:"active"}},se=()=>{J(),p.value=!1,k.value=!0},ie=s=>{o.value={id:s.id,full_name:s.full_name,username:s.username,password:"",email:s.email,department_id:s.department_id||null,role_id:s.role_id||null,position_id:s.position_id||null,gender_id:s.gender_id||null,dob:s.dob||"",status:s.status},p.value=!0,k.value=!0},G=()=>{k.value=!1,J()},oe=async()=>{if(!o.value.full_name||!o.value.username||!o.value.email){alert("Vui lòng điền đầy đủ thông tin bắt buộc");return}if(!p.value&&!o.value.password){alert("Vui lòng nhập mật khẩu");return}z.value=!0;try{const s={...o.value};p.value&&!s.password&&delete s.password,p.value&&s.id?await F(s.id,s):await j(s),await C(),G()}catch(s){console.error("Error submitting form:",s),alert("Có lỗi xảy ra khi lưu dữ liệu")}finally{z.value=!1}},ue=async s=>{if(confirm(`Bạn có chắc chắn muốn xóa người dùng "${s.full_name}"?`))try{await I(s.id),await C()}catch(e){console.error("Error deleting user:",e),alert("Có lỗi xảy ra khi xóa người dùng")}};return me(()=>{C()}),(s,e)=>(u(),r("div",Pe,[n(Ce,{title:"Quản lý Người dùng",description:"Quản lý thông tin người dùng trong hệ thống"}),l("div",Me,[l("div",Ne,[v(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>B.value=t),type:"text",placeholder:"Tìm kiếm người dùng...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[T,B.value]])]),l("div",De,[v(l("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>H.value=t),class:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[...e[16]||(e[16]=[l("option",{value:"all"},"Tất cả trạng thái",-1),l("option",{value:"active"},"Hoạt động",-1),l("option",{value:"inactive"},"Không hoạt động",-1)])],512),[[P,H.value]]),n(b,{onClick:se,class:"flex items-center gap-2"},{default:a(()=>[n(O(pe),{class:"w-4 h-4"}),e[17]||(e[17]=i(" Thêm người dùng ",-1))]),_:1})])]),n(ce,{class:"-mt-2"},{default:a(()=>[n(ye,null,{default:a(()=>[l("div",Ee,[l("div",null,[n(_e,null,{default:a(()=>[...e[18]||(e[18]=[i("Danh sách Người dùng",-1)])]),_:1})]),l("div",Se," Tổng số bản ghi: "+d(le.value.total),1)])]),_:1}),n(be,null,{default:a(()=>[V.value?(u(),r("div",ze,[...e[19]||(e[19]=[l("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"},null,-1),l("p",{class:"mt-2 text-gray-600"},"Đang tải...",-1)])])):S.value.length===0?(u(),r("div",Be,[...e[20]||(e[20]=[l("p",{class:"text-gray-600"},"Không có người dùng nào",-1)])])):(u(),r("div",He,[n(xe,null,{default:a(()=>[n(we,null,{default:a(()=>[n(te,null,{default:a(()=>[n(x,null,{default:a(()=>[...e[21]||(e[21]=[i("Họ tên",-1)])]),_:1}),n(x,null,{default:a(()=>[...e[22]||(e[22]=[i("Tên đăng nhập",-1)])]),_:1}),n(x,null,{default:a(()=>[...e[23]||(e[23]=[i("Email",-1)])]),_:1}),n(x,null,{default:a(()=>[...e[24]||(e[24]=[i("Đơn vị",-1)])]),_:1}),n(x,null,{default:a(()=>[...e[25]||(e[25]=[i("Vai trò",-1)])]),_:1}),n(x,null,{default:a(()=>[...e[26]||(e[26]=[i("Chức vụ",-1)])]),_:1}),n(x,null,{default:a(()=>[...e[27]||(e[27]=[i("Trạng thái",-1)])]),_:1}),n(x,{class:"text-right"},{default:a(()=>[...e[28]||(e[28]=[i("Thao tác",-1)])]),_:1})]),_:1})]),_:1}),n(ke,null,{default:a(()=>[(u(!0),r(h,null,M(S.value,t=>(u(),D(te,{key:t.id,class:"table-row-fixed"},{default:a(()=>[n(w,{class:"align-middle"},{default:a(()=>[l("div",qe,d(t.full_name),1)]),_:2},1024),n(w,{class:"align-middle"},{default:a(()=>[i(d(t.username),1)]),_:2},1024),n(w,{class:"align-middle"},{default:a(()=>[i(d(t.email),1)]),_:2},1024),n(w,{class:"align-middle"},{default:a(()=>[t.department?(u(),D(q,{key:0,variant:"outline",class:"text-xs"},{default:a(()=>[i(d(t.department.name),1)]),_:2},1024)):(u(),r("span",je,"-"))]),_:2},1024),n(w,{class:"align-middle"},{default:a(()=>[t.role?(u(),D(q,{key:0,variant:"outline",class:"text-xs"},{default:a(()=>[i(d(t.role.name),1)]),_:2},1024)):(u(),r("span",Fe,"-"))]),_:2},1024),n(w,{class:"align-middle"},{default:a(()=>[t.position?(u(),D(q,{key:0,variant:"outline",class:"text-xs"},{default:a(()=>[i(d(t.position.name),1)]),_:2},1024)):(u(),r("span",Ie,"-"))]),_:2},1024),n(w,{class:"align-middle"},{default:a(()=>[n(q,{variant:t.status==="active"?"default":"secondary",class:"text-xs"},{default:a(()=>[i(d(t.status==="active"?"Hoạt động":"Không hoạt động"),1)]),_:2},1032,["variant"])]),_:2},1024),n(w,{class:"align-middle text-right"},{default:a(()=>[l("div",Ke,[n(b,{variant:"outline",size:"sm",onClick:m=>ie(t),class:"flex items-center gap-1"},{default:a(()=>[n(O(ge),{class:"w-3 h-3"}),e[29]||(e[29]=i(" Sửa ",-1))]),_:1},8,["onClick"]),n(b,{variant:"outline",size:"sm",onClick:m=>ue(t),class:"flex items-center gap-1 text-red-600 hover:text-red-700"},{default:a(()=>[n(O(ve),{class:"w-3 h-3"}),e[30]||(e[30]=i(" Xóa ",-1))]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),y.value.totalPages>1?(u(),r("div",Qe,[l("div",Ae,[e[32]||(e[32]=l("span",{class:"text-sm text-gray-600"},"Hiển thị:",-1)),l("select",{value:A.value,onChange:e[2]||(e[2]=t=>ae(parseInt(t.target.value))),class:"px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"},[...e[31]||(e[31]=[l("option",{value:"5"},"5",-1),l("option",{value:"10"},"10",-1),l("option",{value:"20"},"20",-1),l("option",{value:"50"},"50",-1)])],40,Le),e[33]||(e[33]=l("span",{class:"text-sm text-gray-600"},"bản ghi/trang",-1))]),l("div",Xe,[n(b,{variant:"outline",size:"sm",disabled:c.value<=1,onClick:e[3]||(e[3]=t=>L(c.value-1))},{default:a(()=>[...e[34]||(e[34]=[i(" Trước ",-1)])]),_:1},8,["disabled"]),l("div",Ge,[(u(!0),r(h,null,M(ne(),t=>(u(),r(h,{key:t},[t!=="..."?(u(),D(b,{key:0,variant:t===c.value?"default":"outline",size:"sm",onClick:m=>L(t),class:"w-8 h-8 p-0"},{default:a(()=>[i(d(t),1)]),_:2},1032,["variant","onClick"])):(u(),r("span",Oe,"..."))],64))),128))]),n(b,{variant:"outline",size:"sm",disabled:c.value>=y.value.totalPages,onClick:e[4]||(e[4]=t=>L(c.value+1))},{default:a(()=>[...e[35]||(e[35]=[i(" Sau ",-1)])]),_:1},8,["disabled"])])])):Y("",!0)]))]),_:1})]),_:1}),k.value?(u(),r("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:G},[l("div",{class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:e[15]||(e[15]=ee(()=>{},["stop"]))},[l("h3",Re,d(p.value?"Sửa người dùng":"Thêm người dùng mới"),1),l("form",{onSubmit:ee(oe,["prevent"]),class:"space-y-4"},[l("div",Ze,[l("div",null,[n(_,{for:"full_name"},{default:a(()=>[...e[36]||(e[36]=[i("Họ và tên *",-1)])]),_:1}),v(l("input",{id:"full_name","onUpdate:modelValue":e[5]||(e[5]=t=>o.value.full_name=t),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Nhập họ và tên"},null,512),[[T,o.value.full_name]])]),l("div",null,[n(_,{for:"username"},{default:a(()=>[...e[37]||(e[37]=[i("Tên đăng nhập *",-1)])]),_:1}),v(l("input",{id:"username","onUpdate:modelValue":e[6]||(e[6]=t=>o.value.username=t),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Nhập tên đăng nhập"},null,512),[[T,o.value.username]])]),l("div",null,[n(_,{for:"email"},{default:a(()=>[...e[38]||(e[38]=[i("Email *",-1)])]),_:1}),v(l("input",{id:"email","onUpdate:modelValue":e[7]||(e[7]=t=>o.value.email=t),type:"email",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Nhập email"},null,512),[[T,o.value.email]])]),l("div",null,[n(_,{for:"password"},{default:a(()=>[i(d(p.value?"Mật khẩu mới (để trống nếu không đổi)":"Mật khẩu *"),1)]),_:1}),v(l("input",{id:"password","onUpdate:modelValue":e[8]||(e[8]=t=>o.value.password=t),type:"password",required:!p.value,class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Nhập mật khẩu"},null,8,Je),[[T,o.value.password]])]),l("div",null,[n(_,{for:"department_id"},{default:a(()=>[...e[39]||(e[39]=[i("Đơn vị",-1)])]),_:1}),v(l("select",{id:"department_id","onUpdate:modelValue":e[9]||(e[9]=t=>o.value.department_id=t),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[e[40]||(e[40]=l("option",{value:""},"Chọn đơn vị",-1)),(u(!0),r(h,null,M(K.value,t=>(u(),r("option",{key:t.id,value:t.id},d(t.name),9,We))),128))],512),[[P,o.value.department_id]])]),l("div",null,[n(_,{for:"role_id"},{default:a(()=>[...e[41]||(e[41]=[i("Vai trò",-1)])]),_:1}),v(l("select",{id:"role_id","onUpdate:modelValue":e[10]||(e[10]=t=>o.value.role_id=t),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[e[42]||(e[42]=l("option",{value:""},"Chọn vai trò",-1)),(u(!0),r(h,null,M(Q.value,t=>(u(),r("option",{key:t.id,value:t.id},d(t.name),9,Ye))),128))],512),[[P,o.value.role_id]])]),l("div",null,[n(_,{for:"position_id"},{default:a(()=>[...e[43]||(e[43]=[i("Chức vụ",-1)])]),_:1}),v(l("select",{id:"position_id","onUpdate:modelValue":e[11]||(e[11]=t=>o.value.position_id=t),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[e[44]||(e[44]=l("option",{value:""},"Chọn chức vụ",-1)),(u(!0),r(h,null,M(g.value,t=>(u(),r("option",{key:t.id,value:t.id},d(t.name),9,et))),128))],512),[[P,o.value.position_id]])]),l("div",null,[n(_,{for:"gender_id"},{default:a(()=>[...e[45]||(e[45]=[i("Giới tính",-1)])]),_:1}),v(l("select",{id:"gender_id","onUpdate:modelValue":e[12]||(e[12]=t=>o.value.gender_id=t),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[e[46]||(e[46]=l("option",{value:""},"Chọn giới tính",-1)),(u(!0),r(h,null,M($.value,t=>(u(),r("option",{key:t.id,value:t.id},d(t.name),9,tt))),128))],512),[[P,o.value.gender_id]])]),l("div",null,[n(_,{for:"dob"},{default:a(()=>[...e[47]||(e[47]=[i("Ngày sinh",-1)])]),_:1}),v(l("input",{id:"dob","onUpdate:modelValue":e[13]||(e[13]=t=>o.value.dob=t),type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[T,o.value.dob]])]),l("div",null,[n(_,{for:"status"},{default:a(()=>[...e[48]||(e[48]=[i("Trạng thái",-1)])]),_:1}),v(l("select",{id:"status","onUpdate:modelValue":e[14]||(e[14]=t=>o.value.status=t),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[...e[49]||(e[49]=[l("option",{value:"active"},"Hoạt động",-1),l("option",{value:"inactive"},"Không hoạt động",-1)])],512),[[P,o.value.status]])])]),l("div",lt,[n(b,{type:"button",variant:"outline",onClick:G},{default:a(()=>[...e[50]||(e[50]=[i(" Hủy ",-1)])]),_:1}),n(b,{type:"submit",disabled:z.value},{default:a(()=>[i(d(z.value?"Đang xử lý...":p.value?"Cập nhật":"Tạo mới"),1)]),_:1},8,["disabled"])])],32)])])):Y("",!0)]))}});export{_t as default};
