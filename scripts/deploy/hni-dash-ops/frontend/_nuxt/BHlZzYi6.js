import{_ as y}from"./qZElNH4Q.js";import{_ as A,a as F,b as V,c as E}from"./HuV0b2Xd.js";import{_ as I}from"./CenQ87kS.js";import{_ as $}from"./BRkL9H2T.js";import{_ as j}from"./vaddv-uB.js";import{u as z}from"./BvMX9gl2.js";import{l as R,d as _,ae as q,A as d,C as a,D as u,B as c,P as g,u as m,am as G,Q as v,N as t,O as i,an as D,F as K,ah as X,ao as O,ap as Q,aq as U,ar as J}from"./CXrpKCn2.js";import{_ as W}from"#entry";import"./BEHD0UYf.js";import"./DrkHBoYJ.js";const Y=()=>{const{handleAsyncError:b}=z();return{getGitLog:async()=>await b(async()=>{const n=await $fetch("/api/git/log");if(!n.success)throw new Error("Failed to fetch git log");return n.data},"Git Log"),formatDate:n=>{try{return new Date(n).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return n}},getCommitHashShort:n=>n.substring(0,7),getCommitMessagePreview:(n,o=50)=>n.length<=o?n:n.substring(0,o)+"..."}},Z={class:"space-y-4"},tt={key:0,class:"flex items-center justify-center py-8"},et={key:1,class:"p-4 border border-red-200 rounded-lg bg-red-50"},st={class:"text-red-600 text-sm mt-1"},ot={key:2,class:"space-y-6"},at={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},rt={class:"p-4 border rounded-lg"},nt={class:"text-lg font-semibold"},it={class:"p-4 border rounded-lg"},lt={class:"text-lg font-semibold"},dt={class:"p-4 border rounded-lg"},ct={class:"text-lg font-semibold"},ut={class:"p-4 border rounded-lg"},mt={key:0,class:"p-4 border border-blue-200 rounded-lg bg-blue-50"},gt={class:"flex items-center gap-2"},ht={key:1,class:"p-4 border border-red-200 rounded-lg bg-red-50"},ft={class:"flex items-center gap-2"},pt={key:2,class:"p-4 border border-yellow-200 rounded-lg bg-yellow-50"},_t={class:"flex items-center gap-2"},vt={class:"text-yellow-800 font-medium"},xt={class:"space-y-4"},yt={class:"space-y-3"},bt={class:"flex items-start justify-between gap-4"},wt={class:"flex-1 min-w-0"},Ct={class:"flex items-center gap-2 mb-2"},kt={class:"text-sm text-muted-foreground"},Lt={class:"text-xs text-muted-foreground"},$t={class:"mb-2"},Gt={class:"font-medium text-sm mb-1"},Dt={key:0,class:"text-xs text-muted-foreground"},Mt={key:0,class:"line-clamp-2"},Bt={key:1,class:"whitespace-pre-wrap"},Ht=["onClick"],St={class:"flex items-center gap-4 text-xs text-muted-foreground"},Tt={class:"flex items-center gap-1"},Pt={class:"flex items-center gap-1"},Nt={class:"flex-shrink-0 flex gap-1"},At={class:"space-y-4"},Ft={class:"p-4 bg-muted rounded-lg"},Vt={class:"text-sm font-mono whitespace-pre-wrap overflow-x-auto"},Et=R({__name:"git-log",setup(b){const{getGitLog:w,formatDate:C,getCommitHashShort:k}=Y(),f=_(!0),n=_(null),o=_(null),h=_(new Set),L=async()=>{f.value=!0,n.value=null;try{o.value=await w()}catch(s){n.value=s.message||"Có lỗi xảy ra khi tải git log"}finally{f.value=!1}},M=async s=>{try{await navigator.clipboard.writeText(s)}catch(e){console.error("Failed to copy commit hash:",e)}},B=async s=>{try{await navigator.clipboard.writeText(s)}catch(e){console.error("Failed to copy commit message:",e)}},H=s=>{try{const e=new Date(s),l=Math.floor((new Date().getTime()-e.getTime())/1e3);return l<60?"Vừa xong":l<3600?`${Math.floor(l/60)} phút trước`:l<86400?`${Math.floor(l/3600)} giờ trước`:l<2592e3?`${Math.floor(l/86400)} ngày trước`:l<31536e3?`${Math.floor(l/2592e3)} tháng trước`:`${Math.floor(l/31536e3)} năm trước`}catch{return"Không xác định"}},S=s=>{switch(s){case"local":return"Local Git";case"github":return"GitHub API";case"fallback":return"Fallback";default:return"Unknown"}},T=s=>s.split(`
`)[0],x=s=>{const e=s.split(`
`);return e.length<=1?"":e.slice(1).filter(l=>l.trim()!=="").join(`
`)},P=s=>x(s).length>0,N=s=>{h.value.has(s)?h.value.delete(s):h.value.add(s)};return q(()=>{L()}),(s,e)=>(c(),d("div",Z,[a(j,{title:"Git Log",description:"Xem lịch sử các lần commit và push code"}),a(A,{class:"-mt-2"},{default:u(()=>[a(F,null,{default:u(()=>[a(V,{class:"flex items-center gap-2"},{default:u(()=>[a(m(G),{class:"h-5 w-5"}),e[0]||(e[0]=g(" Lịch sử Git ",-1))]),_:1}),a(I,null,{default:u(()=>[...e[1]||(e[1]=[g(" Hiển thị thông tin về các lần commit, push và trạng thái repository ",-1)])]),_:1})]),_:1}),a(E,null,{default:u(()=>[f.value?(c(),d("div",tt,[...e[2]||(e[2]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1),t("span",{class:"ml-2 text-muted-foreground"},"Đang tải git log...",-1)])])):n.value?(c(),d("div",et,[e[4]||(e[4]=t("h3",{class:"text-red-800 font-medium"},"Lỗi khi tải git log",-1)),t("p",st,i(n.value),1),a(y,{onClick:L,variant:"outline",size:"sm",class:"mt-2"},{default:u(()=>[...e[3]||(e[3]=[g(" Thử lại ",-1)])]),_:1})])):o.value?(c(),d("div",ot,[t("div",at,[t("div",rt,[e[5]||(e[5]=t("h4",{class:"font-medium text-sm text-muted-foreground mb-1"},"Branch hiện tại",-1)),t("p",nt,i(o.value.currentBranch),1)]),t("div",it,[e[6]||(e[6]=t("h4",{class:"font-medium text-sm text-muted-foreground mb-1"},"Remote branches",-1)),t("p",lt,i(o.value.remoteBranches.length),1)]),t("div",dt,[e[7]||(e[7]=t("h4",{class:"font-medium text-sm text-muted-foreground mb-1"},"Commits gần đây",-1)),t("p",ct,i(o.value.commits.length),1)]),t("div",ut,[e[8]||(e[8]=t("h4",{class:"font-medium text-sm text-muted-foreground mb-1"},"Nguồn dữ liệu",-1)),a($,{variant:o.value.source==="local"?"default":o.value.source==="github"?"secondary":"destructive",class:"text-xs"},{default:u(()=>[g(i(S(o.value.source)),1)]),_:1},8,["variant"])])]),o.value.source==="github"?(c(),d("div",mt,[t("div",gt,[a(m(G),{class:"h-5 w-5 text-blue-600"}),e[9]||(e[9]=t("h3",{class:"text-blue-800 font-medium"},"Dữ liệu từ GitHub API",-1))]),e[10]||(e[10]=t("p",{class:"text-blue-600 text-sm mt-1"}," Đang hiển thị dữ liệu từ GitHub repository (production mode) ",-1))])):o.value.source==="fallback"?(c(),d("div",ht,[t("div",ft,[a(m(D),{class:"h-5 w-5 text-red-600"}),e[11]||(e[11]=t("h3",{class:"text-red-800 font-medium"},"Dữ liệu fallback",-1))]),e[12]||(e[12]=t("p",{class:"text-red-600 text-sm mt-1"}," Không thể truy cập GitHub API, hiển thị dữ liệu mặc định ",-1))])):v("",!0),o.value.lastPush?(c(),d("div",pt,[t("div",_t,[a(m(D),{class:"h-5 w-5 text-yellow-600"}),t("h3",vt,"Có "+i(o.value.lastPush.unpushed)+" commit chưa push",1)]),e[13]||(e[13]=t("p",{class:"text-yellow-600 text-sm mt-1"}," Các commit này chưa được đẩy lên remote repository ",-1))])):v("",!0),t("div",xt,[e[14]||(e[14]=t("h3",{class:"text-lg font-semibold"},"Commits gần đây",-1)),t("div",yt,[(c(!0),d(K,null,X(o.value.commits,r=>(c(),d("div",{key:r.hash,class:"p-4 border rounded-lg hover:bg-muted/50 transition-colors"},[t("div",bt,[t("div",wt,[t("div",Ct,[a($,{variant:"outline",class:"font-mono text-xs"},{default:u(()=>[g(i(m(k)(r.hash)),1)]),_:2},1024),t("span",kt,i(r.author),1),t("span",Lt,i(r.email),1)]),t("div",$t,[t("h4",Gt,i(T(r.message)),1),P(r.message)?(c(),d("div",Dt,[h.value.has(r.hash)?(c(),d("div",Bt,i(x(r.message)),1)):(c(),d("div",Mt,i(x(r.message)),1)),t("button",{onClick:l=>N(r.hash),class:"text-primary hover:underline mt-1"},i(h.value.has(r.hash)?"Thu gọn":"Xem thêm"),9,Ht)])):v("",!0)]),t("div",St,[t("span",Tt,[a(m(O),{class:"h-3 w-3"}),g(" "+i(m(C)(r.date)),1)]),t("span",Pt,[a(m(Q),{class:"h-3 w-3"}),g(" "+i(H(r.date)),1)])])]),t("div",Nt,[a(y,{variant:"ghost",size:"sm",onClick:l=>M(r.hash),class:"h-8 w-8 p-0",title:"Copy commit hash"},{default:u(()=>[a(m(U),{class:"h-4 w-4"})]),_:1},8,["onClick"]),a(y,{variant:"ghost",size:"sm",onClick:l=>B(r.message),class:"h-8 w-8 p-0",title:"Copy commit message"},{default:u(()=>[a(m(J),{class:"h-4 w-4"})]),_:1},8,["onClick"])])])]))),128))])]),t("div",At,[e[15]||(e[15]=t("h3",{class:"text-lg font-semibold"},"Raw Git Log",-1)),t("div",Ft,[t("pre",Vt,i(o.value.rawLog),1)])])])):v("",!0)]),_:1})]),_:1})]))}}),Jt=W(Et,[["__scopeId","data-v-65f3c31d"]]);export{Jt as default};
