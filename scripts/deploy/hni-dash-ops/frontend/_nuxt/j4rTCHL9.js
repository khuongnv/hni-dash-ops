import{l as he,d as v,m as le,ae as xe,i as ye,A as f,C as l,N as n,Q as A,D as a,B as d,P as o,u as p,af as we,V as O,ag as h,O as u,E as M,F as z,ah as B,J as ke,ai as Ce,aj as Le,ak as Me,Z as Ie}from"./CXrpKCn2.js";import{u as Te,a as $e}from"./8e_F_6f1.js";import{_ as De}from"./vaddv-uB.js";import{_ as U,a as Z,b as G,c as W}from"./HuV0b2Xd.js";import{_ as Y}from"./CenQ87kS.js";import{_ as x}from"./qZElNH4Q.js";import{_ as F}from"./DuwWExOE.js";import{_ as w}from"./CchPNN15.js";import{_ as Ne,a as Pe,b as Q,c as y,d as Ee,e as m}from"./DEZtr9RY.js";import{_ as se}from"./BRkL9H2T.js";import{u as Se}from"./BYp8H9Jv.js";import"./wptq1C8v.js";import"#entry";import"./DrkHBoYJ.js";import"./BEHD0UYf.js";const je={class:"h-full flex flex-col space-y-6"},He={class:"flex items-center justify-between"},Ae={class:"flex items-center gap-4"},Oe={class:"flex items-center gap-2"},ze={class:"rounded-md border"},Be={class:"flex items-center justify-center gap-2"},Fe={class:"flex items-center gap-2"},Qe={class:"flex items-center"},Ve={key:0,class:"w-3 h-3 flex items-center justify-center"},Ke={key:1,class:"w-3 h-3 flex items-center justify-center"},Re=["onClick","title"],qe={key:1,class:"w-4 h-4"},Xe={class:"text-xs bg-muted px-1 rounded"},Je={key:0,class:"text-sm text-muted-foreground"},Ue={key:1,class:"text-sm text-muted-foreground"},Ze={class:"flex items-center gap-1"},Ge={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},We={class:"grid gap-4 md:grid-cols-2"},Ye={class:"space-y-2"},et={class:"space-y-2"},tt={class:"grid gap-4 md:grid-cols-2"},lt={class:"space-y-2"},st=["value"],at=["value"],nt={class:"space-y-2"},rt={class:"grid gap-4 md:grid-cols-2"},ot={class:"space-y-2"},it=["value"],dt=["value"],ut={class:"space-y-2"},ft={class:"flex h-10 w-full items-center rounded-md border border-input bg-muted px-3 py-2 text-sm text-muted-foreground"},ct={class:"flex items-center space-x-2"},vt=["checked"],pt={class:"flex justify-end gap-2 pt-4"},mt={key:1,class:"fixed inset-0 z-50 flex items-center justify-center"},gt={class:"space-y-2"},_t={class:"flex justify-end gap-2 pt-4"},St=he({__name:"menus",setup(bt){Se({title:"Quản lý Menu - HNI Dashboard"});const g=v([]),I=v(!1),$=v(!1),D=v(!1),N=v(""),P=v(!1),V=v(!1),k=v(!1),C=v(null),E=v(new Set),ee=ye("refreshSidebar",()=>{}),K=()=>{ee(),localStorage.setItem("menus-updated",Date.now().toString())},ae=s=>g.value.some(e=>e.ParentId===s),ne=s=>{E.value.has(s)?E.value.delete(s):E.value.add(s)},S=s=>E.value.has(s),R=s=>{if(!s.parent_id)return!1;const e=g.value.find(t=>t.id===s.parent_id);return e?S(e.id)?!0:R(e):!1},r=v({id:null,name:"",href:"",icon:"Menu",order:1,parent_id:null,level:1,is_active:!0}),{availableIcons:re,getIconComponent:oe}=$e(),ie=s=>{const e=[],t=new Set,c=s.filter(i=>i.Level===1).sort((i,L)=>i.Order-L.Order),b=i=>{t.has(i.Id)||R(i)||(e.push(i),t.add(i.Id),S(i.Id)||s.filter(_=>_.ParentId===i.Id).sort((_,H)=>_.Order-H.Order).forEach(_=>b(_)))};return c.forEach(i=>b(i)),s.forEach(i=>{!t.has(i.Id)&&!R(i)&&e.push(i)}),e},q=s=>s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/đ/g,"d").replace(/Đ/g,"D"),de=s=>{const e=[];let t=s.ParentId;for(;t;){const c=g.value.find(b=>b.Id===t);if(c)e.unshift(c),t=c.ParentId;else break}return e},X=le(()=>{let s=g.value;if(N.value){const e=N.value.toLowerCase(),t=q(e),c=s.filter(i=>{const L=i.Name.toLowerCase(),_=q(L),H=i.Href.toLowerCase(),be=q(H);return L.includes(e)||_.includes(t)||H.includes(e)||be.includes(t)}),b=new Set;c.forEach(i=>{b.add(i.Id),de(i).forEach(_=>b.add(_.Id))}),s=s.filter(i=>b.has(i.Id))}return ie(s)}),ue=le(()=>g.value.filter(s=>s.Level<4)),fe=s=>{const e=g.value.find(t=>t.Id===s);return e?e.Name:"Không tìm thấy"},T=async()=>{try{I.value=!0;const{getMenus:s}=Te(),e=await s();g.value=e||[]}catch(s){console.error("Error loading menus:",s)}finally{I.value=!1}},te=()=>{r.value={id:null,name:"",href:"",icon:"Menu",order:1,parent_id:null,level:1,is_active:!0}},ce=s=>{if(r.value.parent_id=s?parseInt(s):null,s){const e=g.value.find(t=>t.id===parseInt(s));r.value.level=e?e.level+1:1}else r.value.level=1},ve=()=>{k.value=!1,te(),P.value=!0},pe=s=>{if(k.value=!0,P.value=!0,r.value.id=s.id,r.value.name=s.name,r.value.href=s.href,r.value.icon=s.icon,r.value.order=s.order,r.value.parent_id=s.parent_id,r.value.is_active=s.is_active,s.parent_id){const e=g.value.find(t=>t.id===s.parent_id);r.value.level=e?e.level+1:1}else r.value.level=1},j=()=>{P.value=!1,te()},me=async()=>{try{if($.value=!0,k.value){const s={name:r.value.name,href:r.value.href,icon:r.value.icon,order:r.value.order,parent_id:r.value.parent_id,level:r.value.level,is_active:r.value.is_active};(await $fetch(`/api/menus/${r.value.id}`,{method:"PUT",body:s})).success&&(await T(),K(),j())}else{const s={name:r.value.name,href:r.value.href,icon:r.value.icon,order:r.value.order,parent_id:r.value.parent_id,level:r.value.level,is_active:r.value.is_active};(await $fetch("/api/menus",{method:"POST",body:s})).success&&(await T(),K(),j())}}catch(s){console.error("Error saving menu:",s)}finally{$.value=!1}},ge=s=>{C.value=s,V.value=!0},J=()=>{V.value=!1,C.value=null},_e=async()=>{if(C.value)try{D.value=!0,(await $fetch(`/api/menus/${C.value.id}`,{method:"DELETE"})).success&&(await T(),K(),J())}catch(s){console.error("Error deleting menu:",s)}finally{D.value=!1}};return xe(()=>{T(),ee()}),(s,e)=>(d(),f("div",je,[l(De,{title:"Quản lý Menu hệ thống",description:"Quản lý cấu trúc menu và điều hướng của hệ thống"}),n("div",He,[n("div",Ae,[l(x,{onClick:ve,class:"flex items-center gap-2"},{default:a(()=>[l(p(we),{class:"w-4 h-4"}),e[7]||(e[7]=o(" Thêm menu mới ",-1))]),_:1}),l(x,{variant:"outline",onClick:T,disabled:I.value},{default:a(()=>[l(p(O),{class:h(["w-4 h-4",{"animate-spin":I.value}])},null,8,["class"]),e[8]||(e[8]=o(" Làm mới ",-1))]),_:1},8,["disabled"])]),n("div",Oe,[l(F,{value:N.value,onInput:e[0]||(e[0]=t=>N.value=t.target.value),placeholder:"Tìm kiếm menu...",class:"w-64"},null,8,["value"])])]),l(U,null,{default:a(()=>[l(Z,null,{default:a(()=>[l(G,null,{default:a(()=>[...e[9]||(e[9]=[o("Danh sách Menu",-1)])]),_:1}),l(Y,null,{default:a(()=>[o(" Tổng cộng "+u(X.value.length)+" menu ",1)]),_:1})]),_:1}),l(W,null,{default:a(()=>[n("div",ze,[l(Ne,null,{default:a(()=>[l(Pe,null,{default:a(()=>[l(Q,null,{default:a(()=>[l(y,{class:"w-12"},{default:a(()=>[...e[10]||(e[10]=[o("#",-1)])]),_:1}),l(y,null,{default:a(()=>[...e[11]||(e[11]=[o("Tên menu",-1)])]),_:1}),l(y,null,{default:a(()=>[...e[12]||(e[12]=[o("Đường dẫn",-1)])]),_:1}),l(y,null,{default:a(()=>[...e[13]||(e[13]=[o("Menu cha",-1)])]),_:1}),l(y,null,{default:a(()=>[...e[14]||(e[14]=[o("Thứ tự",-1)])]),_:1}),l(y,null,{default:a(()=>[...e[15]||(e[15]=[o("Cấp",-1)])]),_:1}),l(y,null,{default:a(()=>[...e[16]||(e[16]=[o("Trạng thái",-1)])]),_:1}),l(y,{class:"w-32"},{default:a(()=>[...e[17]||(e[17]=[o("Thao tác",-1)])]),_:1})]),_:1})]),_:1}),l(Ee,null,{default:a(()=>[I.value?(d(),M(Q,{key:0},{default:a(()=>[l(m,{colspan:"8",class:"text-center py-8"},{default:a(()=>[n("div",Be,[l(p(O),{class:"w-4 h-4 animate-spin"}),e[18]||(e[18]=o(" Đang tải... ",-1))])]),_:1})]),_:1})):X.value.length===0?(d(),M(Q,{key:1},{default:a(()=>[l(m,{colspan:"8",class:"text-center py-8 text-muted-foreground"},{default:a(()=>[...e[19]||(e[19]=[o(" Không có menu nào ",-1)])]),_:1})]),_:1})):(d(!0),f(z,{key:2},B(X.value,t=>(d(),M(Q,{key:t.Id,class:h({"bg-primary/5 border-l-4 border-l-primary":t.Level===1,"bg-blue-50/50 border-l-4 border-l-blue-500":t.Level===2,"bg-green-50/50 border-l-4 border-l-green-500":t.Level===3,"bg-orange-50/50 border-l-4 border-l-orange-500":t.Level>=4})},{default:a(()=>[l(m,{class:"font-medium"},{default:a(()=>[o(u(t.Id),1)]),_:2},1024),l(m,null,{default:a(()=>[n("div",Fe,[n("div",Qe,[(d(!0),f(z,null,B(t.Level-1,c=>(d(),f("div",{key:c,class:"w-4 h-4 flex items-center justify-center"},[c===t.Level-1?(d(),f("div",Ve,[...e[20]||(e[20]=[n("div",{class:"w-4 h-4 border-l-2 border-b-2 border-muted-foreground/60 rounded-bl-sm"},null,-1)])])):(d(),f("div",Ke,[...e[21]||(e[21]=[n("div",{class:"w-px h-3 bg-border"},null,-1)])]))]))),128))]),n("div",{class:h(["flex items-center justify-center rounded-md",t.Level===1?"w-8 h-8 bg-primary/10 border border-primary/20":t.Level===2?"w-6 h-6 bg-blue-50 border border-blue-200":t.Level===3?"w-6 h-6 bg-green-50 border border-green-200":"w-6 h-6 bg-orange-50 border border-orange-200"])},[(d(),M(ke(p(oe)(t.Icon)),{class:h(["w-4 h-4",t.Level===1?"text-primary":t.Level===2?"text-blue-600":t.Level===3?"text-green-600":"text-orange-600"])},null,8,["class"]))],2),ae(t.Id)?(d(),f("button",{key:0,onClick:c=>ne(t.Id),class:"flex items-center justify-center w-4 h-4 rounded hover:bg-muted transition-colors cursor-pointer",title:S(t.Id)?"Mở rộng":"Thu gọn"},[l(p(Ce),{class:h(["w-3 h-3 transition-transform duration-200 text-muted-foreground",S(t.Id)?"rotate-0":"rotate-90"])},null,8,["class"])],8,Re)):(d(),f("div",qe)),n("span",{class:h({"font-semibold text-foreground":t.Level===1,"font-medium text-blue-700":t.Level===2,"text-green-700":t.Level===3,"text-orange-700":t.Level>=4})},u(t.Name),3)])]),_:2},1024),l(m,null,{default:a(()=>[n("code",Xe,u(t.Href==="#parent"?"#":t.Href),1)]),_:2},1024),l(m,null,{default:a(()=>[t.ParentId?(d(),f("span",Je,u(fe(t.ParentId)),1)):(d(),f("span",Ue,"-"))]),_:2},1024),l(m,null,{default:a(()=>[o(u(t.Order),1)]),_:2},1024),l(m,null,{default:a(()=>[l(se,{variant:t.Level===1||t.Level===2?"secondary":t.Level===3?"outline":"secondary",class:h({"bg-red-100 text-red-800 font-medium":t.Level===1,"bg-blue-100 text-blue-800 font-medium":t.Level===2,"bg-green-100 text-green-800 font-medium":t.Level===3,"bg-orange-100 text-orange-800 font-medium":t.Level>=4})},{default:a(()=>[n("span",{class:h({"text-red-800":t.Level===1,"text-blue-800":t.Level===2,"text-green-800":t.Level===3,"text-orange-800":t.Level>=4})}," Cấp "+u(t.Level),3)]),_:2},1032,["variant","class"])]),_:2},1024),l(m,null,{default:a(()=>[l(se,{variant:t.IsActive?"default":"destructive"},{default:a(()=>[o(u(t.IsActive?"Hoạt động":"Tạm dừng"),1)]),_:2},1032,["variant"])]),_:2},1024),l(m,null,{default:a(()=>[n("div",Ze,[l(x,{variant:"ghost",size:"sm",onClick:c=>pe(t)},{default:a(()=>[l(p(Le),{class:"w-4 h-4"})]),_:1},8,["onClick"]),l(x,{variant:"ghost",size:"sm",onClick:c=>ge(t),class:"text-destructive hover:text-destructive"},{default:a(()=>[l(p(Me),{class:"w-4 h-4"})]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})])]),_:1})]),_:1}),P.value?(d(),f("div",Ge,[n("div",{class:"fixed inset-0 bg-black/50",onClick:j}),l(U,{class:"relative w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"},{default:a(()=>[l(Z,null,{default:a(()=>[l(G,null,{default:a(()=>[o(u(k.value?"Chỉnh sửa Menu":"Thêm Menu Mới"),1)]),_:1}),l(Y,null,{default:a(()=>[o(u(k.value?"Cập nhật thông tin menu":"Tạo menu mới cho hệ thống"),1)]),_:1})]),_:1}),l(W,null,{default:a(()=>[n("form",{onSubmit:Ie(me,["prevent"]),class:"space-y-4"},[n("div",We,[n("div",Ye,[l(w,{for:"name"},{default:a(()=>[...e[22]||(e[22]=[o("Tên menu *",-1)])]),_:1}),l(F,{id:"name",value:r.value.name,onInput:e[1]||(e[1]=t=>r.value.name=t.target.value),placeholder:"Nhập tên menu",required:""},null,8,["value"])]),n("div",et,[l(w,{for:"href"},{default:a(()=>[...e[23]||(e[23]=[o("Đường dẫn",-1)])]),_:1}),l(F,{id:"href",value:r.value.href,onInput:e[2]||(e[2]=t=>r.value.href=t.target.value),placeholder:"/path/to/page (dùng # cho menu cha)"},null,8,["value"]),e[24]||(e[24]=n("p",{class:"text-xs text-muted-foreground"},' Dùng "#" nếu menu này chỉ dùng để phân tầng (có menu con) ',-1))])]),n("div",tt,[n("div",lt,[l(w,{for:"icon"},{default:a(()=>[...e[25]||(e[25]=[o("Icon",-1)])]),_:1}),n("select",{id:"icon",value:r.value.icon,onChange:e[3]||(e[3]=t=>r.value.icon=t.target.value),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},[(d(!0),f(z,null,B(p(re),t=>(d(),f("option",{key:t,value:t},u(t),9,at))),128))],40,st)]),n("div",nt,[l(w,{for:"order"},{default:a(()=>[...e[26]||(e[26]=[o("Thứ tự",-1)])]),_:1}),l(F,{id:"order",value:r.value.order,onInput:e[4]||(e[4]=t=>r.value.order=parseInt(t.target.value)||1),type:"number",min:"1",placeholder:"1"},null,8,["value"])])]),n("div",rt,[n("div",ot,[l(w,{for:"parent"},{default:a(()=>[...e[27]||(e[27]=[o("Menu cha",-1)])]),_:1}),n("select",{id:"parent",value:r.value.parent_id,onChange:e[5]||(e[5]=t=>ce(t.target.value)),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},[e[28]||(e[28]=n("option",{value:null},"Không có menu cha",-1)),(d(!0),f(z,null,B(ue.value,t=>(d(),f("option",{key:t.id,value:t.id},u("  ".repeat(t.level-1))+u(t.name),9,dt))),128))],40,it)]),n("div",ut,[l(w,null,{default:a(()=>[...e[29]||(e[29]=[o("Cấp menu",-1)])]),_:1}),n("div",ft,u(r.value.level),1)])]),n("div",ct,[n("input",{id:"is_active",checked:r.value.is_active,onChange:e[6]||(e[6]=t=>r.value.is_active=t.target.checked),type:"checkbox",class:"rounded"},null,40,vt),l(w,{for:"is_active"},{default:a(()=>[...e[30]||(e[30]=[o("Menu hoạt động",-1)])]),_:1})]),n("div",pt,[l(x,{type:"button",variant:"outline",onClick:j},{default:a(()=>[...e[31]||(e[31]=[o(" Hủy ",-1)])]),_:1}),l(x,{type:"submit",disabled:$.value},{default:a(()=>[$.value?(d(),M(p(O),{key:0,class:"w-4 h-4 animate-spin mr-2"})):A("",!0),o(" "+u(k.value?"Cập nhật":"Tạo mới"),1)]),_:1},8,["disabled"])])],32)]),_:1})]),_:1})])):A("",!0),V.value?(d(),f("div",mt,[n("div",{class:"fixed inset-0 bg-black/50",onClick:J}),l(U,{class:"relative w-full max-w-md mx-4"},{default:a(()=>[l(Z,null,{default:a(()=>[l(G,{class:"text-destructive"},{default:a(()=>[...e[32]||(e[32]=[o("Xác nhận xóa",-1)])]),_:1}),l(Y,null,{default:a(()=>[...e[33]||(e[33]=[o(" Bạn có chắc chắn muốn xóa menu này không? ",-1)])]),_:1})]),_:1}),l(W,null,{default:a(()=>[n("div",gt,[n("p",null,[e[34]||(e[34]=n("strong",null,"Tên:",-1)),o(" "+u(C.value?.name),1)]),n("p",null,[e[35]||(e[35]=n("strong",null,"Đường dẫn:",-1)),o(" "+u(C.value?.href),1)]),e[36]||(e[36]=n("p",{class:"text-sm text-muted-foreground"}," Hành động này không thể hoàn tác. ",-1))]),n("div",_t,[l(x,{variant:"outline",onClick:J},{default:a(()=>[...e[37]||(e[37]=[o(" Hủy ",-1)])]),_:1}),l(x,{variant:"destructive",onClick:_e,disabled:D.value},{default:a(()=>[D.value?(d(),M(p(O),{key:0,class:"w-4 h-4 animate-spin mr-2"})):A("",!0),e[38]||(e[38]=o(" Xóa ",-1))]),_:1},8,["disabled"])])]),_:1})]),_:1})])):A("",!0)]))}});export{St as default};
