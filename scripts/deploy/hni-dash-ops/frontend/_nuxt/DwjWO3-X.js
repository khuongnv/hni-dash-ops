import{u as w}from"./BvMX9gl2.js";import{g as N}from"#entry";import{d as r,m as T,aL as u}from"./CXrpKCn2.js";const $=()=>{const{handleAsyncError:v}=w(),g=N(),t=r(null),o=r(null),s=r(""),n=r([]),f=T(()=>!!t.value&&!!o.value),i=r(!1),d=()=>{if(typeof window<"u"&&!i.value){const a=localStorage.getItem("auth_user"),l=localStorage.getItem("auth_token"),m=localStorage.getItem("auth_role"),e=localStorage.getItem("auth_menu_ids");if(a&&l)try{t.value=JSON.parse(a),o.value=l,s.value=m||"",n.value=e?JSON.parse(e):[]}catch(U){console.error("Error parsing saved auth data:",U),c()}i.value=!0}};typeof window<"u"&&d();const p=async(a,l)=>await v(async()=>{console.log("Login request:",{url:`${g.public.apiBaseUrl}/api/Auth/login`,body:{UsernameOrEmail:a,Password:l}});const e=await $fetch(`${g.public.apiBaseUrl}/api/Auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:{UsernameOrEmail:a,Password:l}});return console.log("Login response:",e),console.log("Response Status:",e.Status),console.log("Response User:",e.User),console.log("Response Token:",e.Token),e.Status==="Success"&&e.User&&e.Token?(console.log("Login successful, setting user data..."),t.value=e.User,o.value=e.Token,s.value=e.Role,n.value=e.MenuIds,typeof window<"u"&&(localStorage.setItem("auth_user",JSON.stringify(e.User)),localStorage.setItem("auth_token",e.Token),localStorage.setItem("auth_role",e.Role),localStorage.setItem("auth_menu_ids",JSON.stringify(e.MenuIds))),!0):!1},"Đăng nhập")||!1,c=()=>{t.value=null,o.value=null,s.value="",n.value=[],typeof window<"u"&&(localStorage.removeItem("auth_user"),localStorage.removeItem("auth_token"),localStorage.removeItem("auth_role"),localStorage.removeItem("auth_menu_ids"))},h=()=>{c()},S=()=>t.value,I=()=>o.value,y=()=>s.value,_=()=>n.value,k=()=>t.value?`${t.value.firstName||""} ${t.value.lastName||""}`.trim()||t.value.username:"";return{user:u(t),token:u(o),role:u(s),menuIds:u(n),isAuthenticated:f,isInitialized:u(i),login:p,logout:h,getCurrentUser:S,getToken:I,getRole:y,getMenuIds:_,getUserDisplayName:k,initializeAuth:d,clearAuthData:c}};export{$ as u};
