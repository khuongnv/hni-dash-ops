import{a as T,b as j}from"#entry";import{_ as f}from"./qZElNH4Q.js";import{u as B}from"./fRJuXbyB.js";import{l as N,d as i,ae as L,A as o,N as e,Q as X,C as l,u,O as d,D as v,B as r,as as x,aA as k,P as y}from"./CXrpKCn2.js";import"./BEHD0UYf.js";import"./BvMX9gl2.js";const q={class:"min-h-screen flex items-center justify-center bg-gray-50"},D={class:"max-w-md w-full space-y-8"},A={class:"text-center"},E={class:"mx-auto h-12 w-12 flex items-center justify-center"},K={key:0,class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},M={key:1,class:"h-12 w-12 flex items-center justify-center rounded-full bg-red-100"},Q={key:2,class:"h-12 w-12 flex items-center justify-center rounded-full bg-green-100"},R={class:"mt-6 text-3xl font-extrabold text-gray-900"},U={class:"mt-2 text-sm text-gray-600"},P={key:0,class:"mt-8"},$={class:"bg-red-50 border border-red-200 rounded-md p-4"},z={class:"flex"},F={class:"flex-shrink-0"},G={class:"ml-3"},H={class:"mt-2 text-sm text-red-700"},I={class:"mt-6 flex justify-center"},J={key:1,class:"mt-8"},W={class:"bg-green-50 border border-green-200 rounded-md p-4"},Y={class:"flex"},Z={class:"flex-shrink-0"},ee={class:"ml-3"},te={class:"mt-2 text-sm text-green-700"},se={class:"mt-6 flex justify-center"},ue=N({__name:"sso-callback",setup(ne){const p=T(),g=j(),{validateSSOToken:S,loginSSOUser:b}=B(),a=i(!0),s=i(null),c=i(!1),h=i(null),C=()=>a.value?"Đang xác thực...":s.value?"Xác thực thất bại":c.value?"Đăng nhập thành công":"Xác thực SSO",O=()=>a.value?"Vui lòng chờ trong giây lát...":s.value?"Có lỗi xảy ra trong quá trình xác thực":c.value?"Bạn đã đăng nhập thành công":"Đang xử lý...",w=()=>{g.push("/login")},m=()=>{g.push("/main/dashboard")},V=async()=>{try{a.value=!0,s.value=null;const n=p.query.tokenkey;if(console.log("SSO Callback - Tokenkey:",n),!n){s.value="Không tìm thấy token xác thực";return}console.log("SSO Callback - Validating token...");const t=await S(n);if(console.log("SSO Callback - Validation result:",t),!t||!t.success){s.value=t?.error||"Xác thực SSO thất bại";return}if(!t.user){s.value="Không tìm thấy thông tin người dùng";return}console.log("SSO Callback - Logging in user...");const _=await b(t.user,t.ssoUser,t.tokenkey);if(console.log("SSO Callback - Login success:",_),!_){s.value="Đăng nhập thất bại";return}h.value=t.user,c.value=!0,setTimeout(()=>{m()},2e3)}catch(n){console.error("SSO Callback Error:",n),s.value=n.message||"Có lỗi xảy ra trong quá trình xác thực"}finally{a.value=!1}};return L(()=>{V()}),(n,t)=>(r(),o("div",q,[e("div",D,[e("div",A,[e("div",E,[a.value?(r(),o("div",K)):s.value?(r(),o("div",M,[l(u(x),{class:"h-8 w-8 text-red-600"})])):(r(),o("div",Q,[l(u(k),{class:"h-8 w-8 text-green-600"})]))]),e("h2",R,d(C()),1),e("p",U,d(O()),1)]),s.value?(r(),o("div",P,[e("div",$,[e("div",z,[e("div",F,[l(u(x),{class:"h-5 w-5 text-red-400"})]),e("div",G,[t[0]||(t[0]=e("h3",{class:"text-sm font-medium text-red-800"}," Lỗi xác thực SSO ",-1)),e("div",H,[e("p",null,d(s.value),1)])])])]),e("div",I,[l(f,{onClick:w,variant:"outline"},{default:v(()=>[...t[1]||(t[1]=[y(" Quay lại đăng nhập ",-1)])]),_:1})])])):c.value?(r(),o("div",J,[e("div",W,[e("div",Y,[e("div",Z,[l(u(k),{class:"h-5 w-5 text-green-400"})]),e("div",ee,[t[2]||(t[2]=e("h3",{class:"text-sm font-medium text-green-800"}," Đăng nhập thành công ",-1)),e("div",te,[e("p",null,"Chào mừng "+d(h.value?.full_name||h.value?.username)+"!",1)])])])]),e("div",se,[l(f,{onClick:m,variant:"default"},{default:v(()=>[...t[3]||(t[3]=[y(" Vào hệ thống ",-1)])]),_:1})])])):X("",!0)])]))}});export{ue as default};
